<!DOCTYPE html>
<html>
  <head>
    <title>x01d | AngularJs example</title>
    <!-- bootstrap-->
    <link rel="stylesheet" href="vendor/bootstrap/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="vendor/bootstrap/dist/css/bootstrap-theme.min.css">
    <!-- hithlight-->
    <link rel="stylesheet" href="highlight/github.css">
    <script src="highlight/highlight.pack.js"></script>
    <!-- angular-->
    <script src="vendor/angular/angular.js"></script>
    <script src="vendor/angular-route/angular-route.js"></script>
    <!-- users-->
    <script src="js/directives/code_directive.js"></script>
    <script src="js/directives/directives.js"></script>
    <script src="js/controllers/home_controller.js"></script>
    <script src="js/controllers/todo_controller.js"></script>
    <script src="js/controllers/controllers.js"></script>
    <script src="js/app.js"></script>
  </head>
  <body ng-app="x01d">
    <nav class="navbar navbar-default navbar-static-top">
      <div class="container">
        <div class="navbar-header"><a href="#/home" class="navbar-brand">AngularJS Example</a>
          <ul class="nav navbar-nav">
                <li><a href="#/home">Home</a></li>
                <li><a href="#/todo">ToDo list</a></li>
          </ul>
        </div>
      </div>
    </nav>
    <div class="container">
      <ng-view></ng-view>
    </div>
    <script type="text/ng-template" id="home_tpl">
      <div class="row">
        <div class="col-md-9">
          <div class="row">
            <div class="container-fluid">
              <h2>Фабрика, сервис, провайдер???</h2>
              <p>Грубо говоря, данные шаблоны позволяют насоздовать объектов в области видимости всего приложения.</p>
            </div>
            <div class="container-fluid">
              <h3>Factory</h3>
              <p>Возвращает результат выполнения функции</p>
              <code-hightlight>
                <pre><code>app.factory, 'Foo', ->
  {
    property: 'bar'
    method: -> @property
  }</code></pre>
              </code-hightlight>
              <h4>Использование</h4>
              <code-hightlight>
                <pre><code>app.controller, 'BazCtrl', (Foo) ->
  console.log Foo.method() # bar</code></pre>
              </code-hightlight>
            </div>
            <div class="container-fluid">
              <h3>Service</h3>
              <p>Возвращает объект класс (функции в js), то есть выполняется <code>new ServiceClass</code> и результат возвращается</p>
              <code-hightlight>
                <pre><code>app.service, 'MyService', class
  property: 'value'
  method: -> @property</code></pre>
              </code-hightlight>
              <h4>Использование</h4>
              <p>Используется сервис аналогично фабрике</p>
              <code-hightlight>
                <pre><code>app.controller, 'BazCtrl', (MyService) ->
  console.log MyService.method() # value</code></pre>
              </code-hightlight>
            </div>
            <div class="container-fluid">
              <h3>Различия Service и Factory</h3>
              <code-hightlight>
                <pre><code>f = -> 'value'
app.factory 'Foo', f == 'value'
app.service 'Bar', f == new f</code></pre>
              </code-hightlight>
            </div>
            <div class="container-fluid">
              <h3>Provider</h3>
              <p>Провайдер - это сервис с возможностью первичной настройки.</p>
              <p>Используется провайдер как и обычный сервис</p>
              <code-hightlight>
                <pre><code>app.provider 'Foo', class
  value = 'bar'
  getValue: -> value
  setValue: (v) -> value = v
  $get: -> @getValue</code></pre>
              </code-hightlight>
              <p><code>value</code> является приватной переменной, у провайдера есть методы <code>getValue</code> и <code>setValue</code> который возвращают или устанавливают значение переменной <code>value</code>.</p>
              <p>Метод <code>$get</code> должен возвращать сервис, соответсвенно сервис <code>Foo</code> будет создан автоматически после запуска приложения.</p>
              <p>До запуска есть возможность сконфигурировать провайдер.</p>
              <code-hightlight>
                <pre><code>app.config [
  'FooProvider',
  (FooProvider) ->
    FooProvider.setValue('baz')
]</code></pre>
              </code-hightlight>
              <h4>Использование</h4>
              <code-hightlight>
                <pre><code>app.controller, 'BazCtrl', (Foo) ->
  console.log Foo() # baz</code></pre>
              </code-hightlight>
              <p>Таким образом сервис из провайдера образуется следующим образом:</p>
              <code-hightlight>
                <pre><code>new (MyProvider.$get)</code></pre>
              </code-hightlight>
            </div>
            <div class="container-fluid">
              <h3><code>value</code> и <code>constant</code></h3>
              <p>В angularjs есть два дополнительных сервиса <code>value</code> и <code>constant</code>.</p>
              <p>Описываются они аналогично обычным сервисам</p>
              <code-hightlight>
                <pre><code>app.constant 'FOO',
  BAR: 'BAZ'
 
app.value 'foo',
  bar: 'baz'</code></pre>
              </code-hightlight>
              <p>И используются аналогично, в общем конкретных отличий нет, только описываться может только объект, а для констант значения нельзя изменять.</p>
            </div>
            <div class="container-fluid">
              <h3>Зачем весь этот зоопарк?</h3>
              <p>Вообще в angularjs есть только провайдер, все остальное это семантические дополнения. И соответнно когда мы описываем сервис, фабрику или что-то еще, то провайдер создается в любом случае.</p>
            </div>
          </div>
          <h2>Роутеры</h2>
          <code-hightlight>
            <pre><code>app = angular.module 'x01d', [
  'ngRoute'
]
 
app.config [
  '$routeProvider',
  ($routeProvider) ->
    $routeProvider
      .when '/home',
        templateUrl: 'home_tpl'
        controller:  'HomeController'
      .when '/todo',
        templateUrl: 'todo_tpl'
        controller:  'TodoController'
      .otherwise
        redirectTo:  '/home'
]</code></pre>
          </code-hightlight>
        </div>
        <div class="col-md-3"></div>
      </div>
    </script>
    <script type="text/ng-template" id="todo_tpl">
      <h1>{{ message }}</h1>
    </script>
  </body>
</html>